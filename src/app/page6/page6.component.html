<div #mapContainer class="map-container" [class.locked]="!isEditMode"></div>

<input
  type="file"
  #imageInput
  hidden
  (change)="onImageFileSelected($event)"
  accept="image/png, image/jpeg, image/gif"
  [disabled]="!isEditMode"
/>

<div class="controls-drawer" [class.open]="showControlsModal">
  <div class="drawer-backdrop" (click)="closeControlsModal()"></div>
  <div class="drawer-content">
    <div class="drawer-header">
      <h3>Image Controls</h3>
      <button class="close-button" (click)="closeControlsModal()">&times;</button>
    </div>

    <div class="drawer-body">
      <div class="control-group">
        <label for="scale-slider">Scale:</label>
        <div class="control-input">
          <input
            type="range"
            id="scale-slider"
            min="0.1"
            max="5"
            step="0.05"
            [(ngModel)]="imageScale"
            (input)="onScaleChange()"
            [disabled]="!isEditMode"
          />
          <span class="value-display">{{ imageScale.toFixed(2) }}</span>
        </div>
      </div>

      <div class="control-group">
        <label for="rotation-slider">Rotation:</label>
        <div class="control-input">
          <input
            type="range"
            id="rotation-slider"
            min="-180"
            max="180"
            step="1"
            [(ngModel)]="imageRotation"
            (input)="onRotationChange()"
            [disabled]="!isEditMode"
          />
          <span class="value-display">{{ imageRotation }}°</span>
        </div>
      </div>

      <div class="control-group">
        <label for="opacity-slider">Opacity:</label>
        <div class="control-input">
          <input
            type="range"
            id="opacity-slider"
            min="0"
            max="1"
            step="0.05"
            [(ngModel)]="imageOpacity"
            (input)="onOpacityChange()"
            [disabled]="!isEditMode"
          />
          <span class="value-display">{{ (imageOpacity * 100).toFixed(0) }}%</span>
        </div>
      </div>

      <div class="control-group">
        <label>Image Position:</label>
        <div class="position-info" *ngIf="imageCenter">
          <span>Lat: {{ imageCenter.lat.toFixed(6) }}</span>
          <span>Lng: {{ imageCenter.lng.toFixed(6) }}</span>
        </div>
        <div class="position-info" *ngIf="!imageCenter">
          <span>No position set</span>
        </div>
      </div>
    </div>

    <div class="drawer-footer">
      <button *ngIf="isEditMode" class="btn btn-primary" (click)="saveConfiguration()" [disabled]="!imageOverlay">
        Save Configuration
      </button>
      
      <button class="btn btn-danger" (click)="removeImage()" [disabled]="!isEditMode || !imageOverlay">
        Remove Image
      </button>
    </div>
  </div>
</div>

<div class="floating-controls" *ngIf="imageOverlay">
  <button
    class="control-toggle-btn"
    (click)="toggleControlsModal()"
    title="Open Image Controls"
    [disabled]="!isEditMode"
  >
    <span class="icon">⚙️</span>
  </button>
  <button  class="btn btn-warning" (click)="enableEditing()">
        Edit
      </button>
</div>


<div class="quick-info-panel" *ngIf="imageOverlay">
  <div class="info-item">
    <span class="label">Scale:</span>
    <span class="value">{{ imageScale.toFixed(2) }}x</span>
  </div>
  <div class="info-item">
    <span class="label">Rotation:</span>
    <span class="value">{{ imageRotation }}°</span>
  </div>
  <div class="info-item">
    <span class="label">Opacity:</span>
    <span class="value">{{ (imageOpacity * 100).toFixed(0) }}%</span>
  </div>
</div>