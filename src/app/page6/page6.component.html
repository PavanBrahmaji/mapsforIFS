<div class="map-wrapper">
    <!-- This container will hold the map and the edit-mode buttons -->
    <div class="map-container" #mapContainer></div>

    <!-- Buttons for Edit Mode -->
    <div class="map-controls-overlay">
        <!-- Button to Enter Edit Mode -->
        <button *ngIf="!isEditingBoundaries && imageOverlay" (click)="startBoundaryEditMode()" class="map-button edit-button">
            ‚úèÔ∏è Edit Boundaries
        </button>

        <!-- Container for Save/Cancel buttons, shown only in edit mode -->
        <div *ngIf="isEditingBoundaries" class="edit-controls-container">
            <p>You are in edit mode. Modify the boundary on the map using the toolbar.</p>
            <button (click)="saveBoundaryChanges()" class="map-button save-button">üíæ Save Changes</button>
            <button (click)="cancelBoundaryEdit()" class="map-button cancel-button">‚ùå Cancel</button>
        </div>
    </div>
</div>


<!-- Hidden file inputs, they are triggered programmatically -->
<input type="file" #imageInput (change)="onImageFileSelected($event)" accept="image/*" style="display: none;">


<!-- Modal for uploading and adjusting images -->
<div *ngIf="showBoundaryModel" class="modal-backdrop" (click)="closeBoundaryModel()">
    <div class="boundary-model" (click)="$event.stopPropagation()">
        <div class="model-header">
            <h3>Boundary Options</h3>
            <button class="close-btn" (click)="closeBoundaryModel()">‚úï</button>
        </div>
        <div class="model-body">
            <p>{{ boundaryModelContent }}</p>

            <!-- Image Adjustment Canvas and Controls -->
            <div *ngIf="previewImageUrl" class="image-adjustment-container">
                <h4>Image Adjustment:</h4>
                <div class="canvas-wrapper">
                    <canvas #adjustmentCanvas id="adjustmentCanvas" (mousedown)="handleCanvasMouseDown($event)" (mousemove)="handleCanvasMouseMove($event)" (mouseup)="handleCanvasMouseUp($event)" (mouseleave)="handleCanvasMouseUp($event)" (wheel)="handleCanvasWheel($event)"></canvas>
                </div>

                <div class="adjustment-controls">
                    <label for="rotation-slider">Rotate:</label>
                    <input type="range" id="rotation-slider" min="0" max="360" [(ngModel)]="tempImageRotationAngle" (input)="drawAdjustmentCanvas()" />
                    <span>{{ tempImageRotationAngle | number:'1.0-0' }}¬∞</span>
                </div>
            </div>

            <!-- Modal Footer with Conditional Buttons -->
            <div class="model-footer">
                <ng-container *ngIf="!imageOverlay && !previewImageUrl">
                    <button (click)="triggerImageInput()">Upload Image</button>
                </ng-container>

                <ng-container *ngIf="previewImageUrl && !imageOverlay">
                    <button (click)="saveAdjustedImageOverlay()">Save Clipped Image</button>
                    <button class="cancel-button" (click)="closeBoundaryModel()">Cancel</button>
                </ng-container>

                <ng-container *ngIf="imageOverlay && !previewImageUrl">
                    <button (click)="removeImage(); closeBoundaryModel()">Remove Image</button>
                    <button (click)="editExistingImageOverlay()">Edit Image</button>
                </ng-container>

                <ng-container *ngIf="imageOverlay && previewImageUrl">
                    <button (click)="saveAdjustedImageOverlay()">Save Changes</button>
                    <button class="cancel-button" (click)="closeBoundaryModel()">Cancel</button>
                </ng-container>
            </div>
        </div>
    </div>
</div>
