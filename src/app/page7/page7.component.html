<div class="building-context-panel">
  <div class="control-group">
    <label for="building-name">Building:</label>
    <input
      type="text"
      id="building-name"
      class="value-input"
      [(ngModel)]="currentBuilding.name"
      (change)="onBuildingNameChange()"
      placeholder="Enter Building Name"
    />
  </div>
  <div class="control-group">
    <label for="floor-selector">Floor:</label>
    <select
      id="floor-selector"
      class="floor-select"
      [(ngModel)]="selectedFloorId"
      (ngModelChange)="selectFloor($event)"
      [disabled]="!currentBuilding.name"
    >
      <option *ngIf="currentBuilding.floors.length === 0" disabled value="">No floors yet</option>
      <option *ngFor="let floor of currentBuilding.floors" [value]="floor.floorId">
        {{ floor.floorId }}
      </option>
    </select>
    <button
      class="btn btn-small"
      (click)="addNewFloor()"
      [disabled]="!currentBuilding.name"
      title="Add a new floor"
    >+</button>
  </div>
</div>

<div #mapContainer class="map-container"></div>

<input
  type="file"
  #floorImageInput
  hidden
  (change)="onNewFloorImageSelected($event)"
  accept="image/png, image/jpeg, image/gif"
/>

<div class="controls-drawer" [class.open]="showControlsModal">
  <div class="drawer-backdrop" (click)="closeControlsModal()"></div>
  <div class="drawer-content">
    <div class="drawer-header">
      <h3>Controls for {{ currentBuilding.name }} / Floor {{ selectedFloorId }}</h3>
      <button class="close-button" (click)="closeControlsModal()">&times;</button>
    </div>

    <div class="drawer-body">
      <div class="control-group">
        <label for="scale-slider">Scale:</label>
        <div class="control-input">
          <input type="range" id="scale-slider" min="0.1" max="5" step="0.05" [(ngModel)]="imageScale" (input)="onScaleChange()" [disabled]="!isEditMode" />
          <input type="number" class="value-input" min="0.1" max="5" step="0.05" [(ngModel)]="imageScale" (change)="onScaleChange()" [disabled]="!isEditMode" />
        </div>
      </div>
      <div class="control-group">
        <label for="rotation-slider">Rotation:</label>
        <div class="control-input">
          <input type="range" id="rotation-slider" min="-180" max="180" step="1" [(ngModel)]="imageRotation" (input)="onRotationChange()" [disabled]="!isEditMode" />
          <input type="number" class="value-input" min="-180" max="180" step="1" [(ngModel)]="imageRotation" (change)="onRotationChange()" [disabled]="!isEditMode" />
        </div>
      </div>
      <div class="control-group">
        <label for="opacity-slider">Opacity:</label>
        <div class="control-input">
          <input type="range" id="opacity-slider" min="0" max="1" step="0.05" [(ngModel)]="imageOpacity" (input)="onOpacityChange()" [disabled]="!isEditMode" />
          <input type="number" class="value-input" min="0" max="1" step="0.05" [(ngModel)]="imageOpacity" (change)="onOpacityChange()" [disabled]="!isEditMode" />
        </div>
      </div>
    </div>

    <div class="drawer-footer">
      <button *ngIf="isEditMode" class="btn btn-primary" (click)="saveConfiguration()">Save Configuration</button>
      <button class="btn btn-danger" (click)="removeImage()" [disabled]="!isEditMode || !imageOverlay">Remove Floor Image</button>
    </div>
  </div>
</div>

<div class="floating-controls">
  <button
    *ngIf="imageOverlay && isEditMode"
    class="control-toggle-btn"
    (click)="toggleControlsModal()"
    title="Open Image Controls"
  >
    <span class="icon">⚙️</span>
  </button>
  <button *ngIf="!isEditMode" class="btn btn-warning" (click)="enableEditing()">
    Edit ✏️
  </button>
</div>